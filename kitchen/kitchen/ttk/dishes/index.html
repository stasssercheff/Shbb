<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ТТК Блюда</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding: 0;
      background-color: #f4f6f8; color: #333;
    }
    .page-header {
      display: flex; justify-content: flex-end;
      padding: 10px 20px; gap: 10px;
      background-color: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      position: sticky; top: 0; z-index: 10;
    }
    .top-btn {
      padding: 8px 16px; background-color: #d8cfc0;
      border: none; border-radius: 6px;
      cursor: pointer; font-weight: 600; font-size: 14px;
      transition: 0.2s;
    }
    .top-btn:hover { background-color: #c1b29a; }

    .main-container {
      max-width: 800px; margin: 40px auto;
      background-color: #fff; padding: 20px; border-radius: 10px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.1);
    }
    .date-container { font-size:14px; color:#666; margin-bottom:20px; text-align:center; }

    .sections-container { display:flex; flex-direction:column; gap:15px; }

    .section-btn {
      background-color:#d8cfc0; padding:15px 20px; border-radius:8px;
      font-size:18px; font-weight:600; cursor:pointer; text-align:center;
      transition:background 0.2s;
    }
    .section-btn:hover { background-color:#c1b29a; }

    .section-panel { display:none; margin-top:10px; }

    .table-container { margin:10px 0; overflow-x:auto; }

    .dish-table {
      width:100%; border-collapse:collapse; margin:10px 0; font-size:14px; background:#fff;
    }
    .dish-table th, .dish-table td { border:1px solid #ccc; padding:6px 8px; text-align:left; vertical-align:top; }
    .dish-table th { background-color:#f9f9f9; font-weight:600; }
  </style>
</head>
<body>

  <header class="page-header">
    <button class="top-btn" onclick="location.href='index.html'">Главная</button>
    <button class="top-btn" onclick="history.back()">Назад</button>
  </header>

  <main class="main-container">
    <div id="current-date" class="date-container"></div>
    <div class="sections-container">
      <div class="section">
        <div class="section-btn" data-section="breakfast">Завтраки</div>
        <div class="section-panel" id="breakfast-section"></div>
      </div>
      <div class="section">
        <div class="section-btn" data-section="soup">Супы</div>
        <div class="section-panel" id="soup-section"></div>
      </div>
      <div class="section">
        <div class="section-btn" data-section="salad">Салаты</div>
        <div class="section-panel" id="salad-section"></div>
      </div>
      <div class="section">
        <div class="section-btn" data-section="main">Основные блюда</div>
        <div class="section-panel" id="main-section"></div>
      </div>
    </div>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const sections = [
        { btnSelector: '.section-btn[data-section="breakfast"]', panelId: 'breakfast-section', json: 'data/breakfast.json' },
        { btnSelector: '.section-btn[data-section="soup"]', panelId: 'soup-section', json: 'data/soup.json' },
        { btnSelector: '.section-btn[data-section="salad"]', panelId: 'salad-section', json: 'data/salad-starter.json' },
        { btnSelector: '.section-btn[data-section="main"]', panelId: 'main-section', json: 'data/main.json' }
      ];

      function el(tag, opts={}) {
        const e = document.createElement(tag);
        for (const [k,v] of Object.entries(opts)) {
          if (k === "text") e.textContent = v;
          else if (k === "html") e.innerHTML = v;
          else e.setAttribute(k,v);
        }
        return e;
      }

      function renderSection(panel, data) {
        panel.innerHTML = "";
        if (!Array.isArray(data) || data.length === 0) {
          panel.innerHTML = `<div style="color:#666;padding:6px;">Нет данных</div>`;
          return;
        }

        data.forEach((dish, i) => {
          const title = el("h3", { text: dish.name?.ru || `Блюдо ${i+1}` });
          title.style.margin = '12px 0 6px';
          panel.appendChild(title);

          const wrapper = el("div", { class: "table-container" });
          panel.appendChild(wrapper);

          const table = el("table", { class: "dish-table" });
          wrapper.appendChild(table);

          const thead = el("thead");
          thead.innerHTML = `
            <tr>
              <th style="width:40px;">№</th>
              <th>Наименование продукта</th>
              <th style="width:100px;">Кол-во</th>
              <th style="min-width:250px;">Технология</th>
              <th style="width:140px;">Фото</th>
            </tr>`;
          table.appendChild(thead);

          const tbody = el("tbody");
          const ingredients = Array.isArray(dish.ingredients) ? dish.ingredients : [];
          const rowsCount = ingredients.length || 1;

          for (let j=0; j<rowsCount; j++) {
            const tr = el("tr");
            const ingText = ingredients[j]?.ru || '-';
            const qtyText = ingredients[j]?.amount || '-';
            tr.innerHTML = `
              <td style="text-align:center;">${j+1}</td>
              <td>${ingText}</td>
              <td style="text-align:center;">${qtyText}</td>
            `;
            if (j===0) {
              const tdProc = el("td", { text: dish.process?.ru || '-' });
              tdProc.rowSpan = rowsCount;
              tdProc.style.verticalAlign = 'top';
              tdProc.style.wordBreak = 'break-word';
              tr.appendChild(tdProc);

              const tdPhoto = el("td");
              tdPhoto.rowSpan = rowsCount;
              tdPhoto.style.verticalAlign = 'top';
              if (dish.photo) {
                const img = el("img");
                img.src = dish.photo;
                img.alt = dish.name?.ru || '';
                img.style.maxWidth = "120px";
                img.style.height = "auto";
                img.style.display = "block";
                tdPhoto.appendChild(img);
              } else tdPhoto.textContent = "-";
              tr.appendChild(tdPhoto);
            }
            tbody.appendChild(tr);
          }

          table.appendChild(tbody);
        });
      }

      sections.forEach(section => {
        const btn = document.querySelector(section.btnSelector);
        const panel = document.getElementById(section.panelId);

        if (!btn || !panel) return;

        btn.addEventListener("click", async () => {
          panel.style.display = panel.style.display === "block" ? "none" : "block";
          if (panel.innerHTML.trim() !== "") return; // уже загружено

          try {
            const res = await fetch(section.json + "?_=" + Date.now());
            if (!res.ok) throw new Error(res.statusText);
            const data = await res.json();
            renderSection(panel, data);
          } catch(err) {
            panel.innerHTML = `<div style="color:red;padding:6px;">Ошибка загрузки: ${err.message}</div>`;
          }
        });
      });
    });
  </script>

</body>
</html>